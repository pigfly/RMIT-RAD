# Rails + C9 Setup
- We strongly encourage you to use C9 for bootstrap your development environment
  - Sign up and enjoy AWS Free Tier for 12 months: https://aws.amazon.com/free/
- If you wish to use docker for local environment, checkout the previous docs: ../2022_s1/bootstrap

## Workspace settings
When creating a Cloud9 Environment, use Ubuntu not Amazon Linux

## Cloud9 Editor Settings
- Strip Whitespace
- Soft tabs (2)

## Postgres

First run

```
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt-get update
sudo apt install postgresql postgresql-contrib libpq-dev
```

(The above can cause odd issues with the Y/N if it isn't ran by itself)

Then

```
# ubuntu User setup
sudo service postgresql start
sudo sudo -u postgres psql
CREATE USER ubuntu SUPERUSER PASSWORD 'password'; # You may want to use something more secure
```

## Ruby on Rails (if needed)

### Ruby Version
First install the correct version of ruby. Remove the default version if a downgrade is needed.

```
rvm list
```

Remove via:

```
rvm remove <not required version>
```

install and use default version

```
rvm use --default --install <required version>
```

### Rails Version
run `rails -v` to check your current version of rails. If that isn't the version you want:

Remove the current railties (you may need to add `-v '5.0.0'` at the end) or something if you need to uninstall a specific version.

```
gem uninstall railties
```

Install the correct railties, in this case, anything that is at least 5.2.X but less than 5.3

```
gem install railties -v '~> 5.2.0'
```

Here is an example for an exact version:

```
gem install railties -v '5.2.4.1'
```

Once that installs, you should update the gemfile to use the version of rails installed by the railties

Update the gemfile to use the correct version (if needed)

```
gem rails, '~> 5.2.0'
```

Though you should replace the `~> 5.2.0` with the actual version it installs ie:

```
gem rails, '5.2.4.1'
```

### Rails Setup
#### For New Rails App
Create a new rails app if needed
Add Setup Rails if needed (if not migrating)

https://guides.rubyonrails.org/v5.2/getting_started.html

Use `rails new -h` to get the options for setup.

For simple rails apps, one can use these options: 

- `--database=postgresql` for postgres
- `--skip-test` if you won't be following TDD or plan to use rspec instead of the built-in test lib.

#### Bundler Setup
Setup bundler

```
gem install bundler
bundle install
```

## Postgres Rails DB Setup

```
# Do the postgres setup for cloud9
rake db:create
rake db:migrate
rake db:seed # Optional, may not always be needed or desired. Use caution. For new rails apps, this is safe to run as it does nothing.
```

You can run them all at once using:

```
rake db:create db:migrate db:seed
```

## Rails Console
Solves `FATAL: Listen error: unable to monitor directories for changes.` error if it comes up.

```
echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf && sudo sysctl -p
```

## Gitignore

```
# See https://help.github.com/articles/ignoring-files for more about ignoring files.
#
# If you find yourself ignoring temporary files generated by your text editor
# or operating system, you probably want to add a global ignore instead:
#   git config --global core.excludesfile '~/.gitignore_global'

# Ignore bundler config.
/.bundle

# Ignore all logfiles and tempfiles.
/log/*
/tmp/*
!/log/.keep
!/tmp/.keep

# Ignore uploaded files in development
/storage/*
!/storage/.keep

/node_modules
/yarn-error.log

/public/assets
.byebug_history

# Ignore master key for decrypting credentials and more.
/config/master.key

/public/packs
/public/packs-test
/node_modules
/yarn-error.log
yarn-debug.log*
.yarn-integrity

.c9/
```